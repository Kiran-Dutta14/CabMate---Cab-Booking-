<div class="dashboard">
  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Right Content -->
  <div class="main-content">
    <div class="navbar">
      <h3>Fares & Rides</h3>
    </div>

    <!-- Revenue Cards -->
    <div class="cards">
      <div class="card">
        <h4>Total Revenue</h4>
        <p class="amount">$90.50</p>
        <small>+12.5% from last month</small>
      </div>
      <div class="card">
        <h4>Average Fare</h4>
        <p class="amount">$45.25</p>
        <small>Per completed ride</small>
      </div>
      <div class="card">
        <h4>Total Rides</h4>
        <p class="amount">{{ rides.length }}</p>
        <small>All time bookings</small>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button [class.active]="activeTab === 'fare-rules'" (click)="activeTab='fare-rules'">Fare Rules</button>
      <button [class.active]="activeTab === 'ride-history'" (click)="activeTab='ride-history'">Ride History</button>
    </div>

    <!-- Fare Rules Table -->
    <div *ngIf="activeTab === 'fare-rules'" class="table">
      <div class="header">
        <h2>Fare Rules</h2>
        <p>Configure pricing for different vehicle types</p>
        <button class="add-btn" (click)="openAddFareRuleModal()">+ Add Fare Rule</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Rule Name</th>
            <th>Vehicle Type</th>
            <th>Base Fare</th>
            <th>Per KM</th>
            <th>Per Minute</th>
            <th>Min Fare</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let f of fareRules">
            <td>{{ f.ruleName }}</td>
            <td><span class="badge type">{{ f.vehicleType }}</span></td>
            <td>\${{ f.baseFare }}</td>
            <td>\${{ f.perKm }}</td>
            <td>\${{ f.perMinute }}</td>
            <td>\${{ f.minFare }}</td>
            <td><span class="badge status active">{{ f.status }}</span></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Ride History Table -->
    <div *ngIf="activeTab === 'ride-history'" class="table">
      <div class="header">
        <h2>Ride History</h2>
        <p>View all completed and ongoing rides</p>
      </div>
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Driver</th>
            <th>Route</th>
            <th>Fare</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of rides">
            <td>
              <strong>{{ r.user?.name }}</strong><br>
              <span class="email">{{ r.user?.email }}</span>
            </td>
            <td>{{ r.driver?.name || 'Unassigned' }}</td>
            <td>{{ r.pickupLocation }} â†’ {{ r.dropoffLocation }}</td>
            <td>\${{ r.fare }}</td>
            <td><span class="badge status" [ngClass]="r.status">{{ r.status }}</span></td>
            <td>{{ r.rideTime | date:'medium' }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Add Fare Rule Modal -->
    <div class="modal" *ngIf="showAddFareRuleModal">
      <div class="modal-content">
        <h2>Add New Fare Rule</h2>
        <form (ngSubmit)="addFareRule()" #fareRuleForm="ngForm">
          
          <div class="form-group">
            <label>Rule Name</label>
            <input type="text" placeholder="e.g. Standard Sedan Rate"
                  [(ngModel)]="newFareRule.ruleName" name="ruleName" required />
          </div>

          <div class="form-group">
            <label>Vehicle Type</label>
            <select [(ngModel)]="newFareRule.vehicleType" name="vehicleType" required>
              <option value="" disabled selected>Select type</option>
              <option value="Car">Car</option>
              <option value="Bike">Bike</option>
              <option value="Auto">Auto</option>
              <option value="SUV">SUV</option>
              <option value="Luxury">Luxury</option>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Base Fare ($)</label>
              <input type="number" [(ngModel)]="newFareRule.baseFare" name="baseFare" placeholder="5.00" required />
            </div>
            <div class="form-group">
              <label>Minimum Fare ($)</label>
              <input type="number" [(ngModel)]="newFareRule.minFare" name="minFare" placeholder="10.00" required />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Per KM Rate ($)</label>
              <input type="number" [(ngModel)]="newFareRule.perKm" name="perKm" placeholder="2.50" required />
            </div>
            <div class="form-group">
              <label>Per Minute ($)</label>
              <input type="number" [(ngModel)]="newFareRule.perMinute" name="perMinute" placeholder="0.50" required />
            </div>
          </div>

          <div class="modal-actions">
            <button type="button" (click)="closeAddFareRuleModal()">Cancel</button>
            <button type="submit" [disabled]="!fareRuleForm.form.valid">Add Rule</button>
          </div>
        </form>
      </div>
    </div>

  </div>
</div>
